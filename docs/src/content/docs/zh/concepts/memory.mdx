---
title: 内存管理
description: 理解内存管理 - AI工作流的持久状态管理
---

内存管理为AI代理工作流提供持久状态和上下文管理，使用LangGraph的Store和Checkpointer系统，使代理能够跨会话维护对话历史、知识和实体信息。

## 什么是内存管理？

langcrew中的内存管理提供：

- **短期记忆**：使用LangGraph Checkpointer的基于会话的对话历史
- **长期记忆**：使用LangGraph Store系统的持久知识存储
- **实体记忆**：跨对话跟踪和记住实体（人员、组织、概念）
- **多提供商支持**：内存、SQLite、PostgreSQL后端（已测试）；Redis、MongoDB、MySQL（实验性）
- **统一配置**：单个MemoryConfig类管理所有内存类型

## 核心架构

内存管理基于[LangGraph的Store和Checkpointer](https://langchain-ai.github.io/langgraph/concepts/persistence/)，具有三种专门的内存类型：

```python
from langcrew import Crew
from langcrew.memory import MemoryConfig

# 统一内存配置
memory_config = MemoryConfig(
    provider="sqlite",
    connection_string="sqlite:///memory.db",
    short_term={"enabled": True, "max_history": 20},
    long_term={"enabled": True, "min_quality": 0.7},
    entity={"enabled": True}
)

crew = Crew(
    agents=[agent],
    memory=memory_config
)
```

## 核心组件

### MemoryConfig

管理所有三种内存类型和存储提供商的统一配置类。

#### 核心参数

| 参数 | 类型 | 描述 | 默认值 |
|------|------|------|--------|
| `enabled` | bool | 启用/禁用内存功能 | True |
| `provider` | str | 存储提供商："memory"、"sqlite"、"postgres"等 | "memory" |
| `connection_string` | str \| None | 数据库连接字符串 | None |
| `short_term` | dict | 短期记忆配置 | 见下文 |
| `long_term` | dict | 长期记忆配置 | 见下文 |
| `entity` | dict | 实体记忆配置 | 见下文 |

### 短期记忆

使用LangGraph Checkpointer系统的基于会话的对话历史，用于即时上下文保留。

**核心特性：**

- 基于线程的会话管理
- 自动上下文注入
- 可配置的历史限制
- 性能本地缓存

```python
# 短期记忆配置
memory_config = MemoryConfig(
    short_term={
        "enabled": True,
        "max_history": 20,    # 要记住的最大对话轮数
    }
)
```

### 长期记忆

使用LangGraph Store系统的持久知识存储，用于跨会话信息保留。

**核心特性：**

- 基于质量的知识过滤
- 基于任务的知识组织
- 代理特定命名空间
- 学习提取和存储

```python
# 长期记忆配置
memory_config = MemoryConfig(
    long_term={
        "enabled": True,
        "min_quality": 0.7       # 存储的最低质量阈值
    }
)
```

### 实体记忆

使用结构化存储跨对话跟踪实体（人员、组织、概念）。

**核心特性：**

- 自动实体识别和更新
- 实体间关系跟踪
- 提及计数和时近性跟踪
- 基于类型的实体组织

```python
# 实体记忆配置
memory_config = MemoryConfig(
    entity={
        "enabled": True,
    }
)
```

## 存储提供商

**✅ 已测试提供商：**

- `memory` - 内存存储（开发/测试）
- `postgresql` - PostgreSQL数据库（生产）
- `sqlite` - SQLite数据库（单用户/开发）

**⚠️ 实验性提供商：**

- `redis` - Redis存储（未完全测试）
- `mongodb` - MongoDB存储（未完全测试）
- `mysql` - MySQL存储（未完全测试）

```python
# PostgreSQL生产配置
memory_config = MemoryConfig(
    provider="postgresql",
    connection_string="postgresql://user:pass@localhost:5432/memory_db"
)

# SQLite开发配置
memory_config = MemoryConfig(
    provider="sqlite",
    connection_string="sqlite:///memory.db"
)
```

## 与langcrew集成

内存管理与所有langcrew组件无缝集成：

- **[代理](/zh/concepts/agents)**：代理继承内存配置以实现上下文感知响应
- **[任务](/zh/concepts/tasks)**：任务跨执行维护状态
- **[团队](/zh/concepts/crews)**：团队成员间共享内存

```python
# 团队间共享内存
from langcrew import Agent, Crew
from langcrew.memory import MemoryConfig

memory_config = MemoryConfig(
    provider="sqlite",
    connection_string="sqlite:///team_memory.db"
)

crew = Crew(
    agents=[agent],
    memory=memory_config  # 所有代理共享此内存
)
```

## 何时使用内存管理

- **对话代理**需要记住用户偏好和对话历史
- **多会话应用程序**需要跨用户交互的连续性
- **知识密集型工作流**需要积累和检索信息
- **团队协作**场景需要共享上下文和实体跟踪
- **客户服务**应用程序需要交互历史和客户档案

## 下一步

- **[内存快速开始](/zh/guides/memory/getting-started)** - 5分钟快速开始
- **[短期记忆](/zh/guides/memory/short-term)** - 基于会话的对话历史
- **[长期记忆](/zh/guides/memory/long-term)** - 持久知识存储
- **[实体记忆](/zh/guides/memory/entity)** - 跨对话跟踪实体
- **[存储配置](/zh/guides/memory/storage)** - 配置存储后端
