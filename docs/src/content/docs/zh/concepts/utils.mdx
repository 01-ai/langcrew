---
title: 工具库
description: 理解工具库 - AI代理开发的实用工具函数
---

工具库为AI代理开发提供实用工具函数和辅助工具集合，包括文件检测、token计数、语言处理和消息处理实用工具。

## 什么是工具库？

langcrew中的工具库提供：
- **文件检测**：智能文件类型检测和编码分析
- **Token计数**：GPT和Claude模型的精确token计数
- **语言检测**：简单的语言识别（中文/英文）
- **消息工具**：消息ID生成和处理辅助工具

## 核心架构

工具库组织为独立的实用工具模块，每个都服务于特定目的：

```python
from langcrew.utils import (
    is_binary_file, is_text_file,      # 文件检测
    TokenCounter,                       # Token计数
    detect_chinese, detect_language,    # 语言检测
    generate_message_id                 # 消息工具
)
```

## 核心组件

### 文件检测
使用多种启发式规则进行二进制/文本分类的智能文件类型检测。

**核心特性：**
- 二进制与文本文件检测
- UTF-8/UTF-16编码验证
- 文件签名识别
- 中文文本支持
- 编码检测

```python
from langcrew.utils.file_detect import is_binary_file, is_text_file

# 检测文件类型
with open('document.pdf', 'rb') as f:
    data = f.read()
    is_binary = is_binary_file(data)  # True
    is_text = is_text_file(data)      # False

# 文件类型提示
from langcrew.utils.file_detect import get_file_type_hint
file_type = get_file_type_hint(data)  # "binary" 或 "text"
```

**检测规则：**
1. 空字节存在（最可靠）
2. 常见二进制文件签名
3. UTF-8/UTF-16编码验证
4. 控制字符比率分析
5. 中文字符模式支持

| 函数 | 用途 | 参数 |
|------|------|------|
| `is_binary_file(data)` | 检测二进制文件 | `data: bytes \| bytearray` |
| `is_text_file(data)` | 检测文本文件 | `data: bytes \| bytearray` |
| `get_file_type_hint(data)` | 获取文件类型提示 | `data: bytes \| bytearray` |

### Token计数
支持GPT和Claude的LLM模型精确token计数。

**核心特性：**
- GPT-4精确token计数
- Claude token估算
- 基于消息的计数
- Token限制常量
- 模型特定编码

```python
from langcrew.utils.token_counter import TokenCounter
from langchain_core.messages import HumanMessage

# 初始化计数器
counter = TokenCounter(model_name="gpt-4")

# 计算消息中的token
messages = [HumanMessage(content="你好，你好吗？")]
token_count, is_exact = counter.count_messages(messages)
print(f"Tokens: {token_count}, Exact: {is_exact}")
```

**常量：**
- `TOKEN_LIMIT = 64000` - 截断的统一token限制
- `MAX_TOKEN_LIMIT = 150000` - 用户上下文的最大token限制

| 方法 | 用途 | 返回值 |
|------|------|--------|
| `count_messages(messages)` | 计算消息列表中的token | `tuple[int, bool]` |
| `_count_gpt_tokens(messages)` | 精确GPT token计数 | `int` |
| `_estimate_claude_tokens(messages)` | 估算Claude token | `int` |

### 语言检测
专注于中英文文本的简单语言识别。

**核心特性：**
- 中文字符检测
- 字符比率分析
- 简单快速处理
- Unicode范围支持

```python
from langcrew.utils.language import detect_chinese, detect_language

# 检测中文文本
is_chinese = detect_chinese("你好世界")  # True
is_chinese = detect_chinese("Hello World")  # False

# 通用语言检测
language = detect_language("你好世界")  # "zh"
language = detect_language("Hello World")  # "en"
```

**检测逻辑：**
- 中文字符：Unicode范围`\u4e00-\u9fff`
- 阈值：30%中文字符 = 中文文本
- 回退：非中文文本为英文

| 函数 | 用途 | 参数 | 返回值 |
|------|------|------|--------|
| `detect_chinese(text)` | 检测中文文本 | `text: str` | `bool` |
| `detect_language(text)` | 检测语言 | `text: str` | `str` ("zh"/"en") |

### 消息工具
消息ID生成和消息处理的辅助函数。

**核心特性：**
- 唯一消息ID生成
- 基于时间戳的ID
- 冲突避免
- 高并发支持

```python
from langcrew.utils.message_utils import generate_message_id

# 生成唯一消息ID
msg_id = generate_message_id()
# 格式："1748438204041_a7k9"（时间戳_随机后缀）
```

**ID格式：**
- 时间戳：自纪元以来的毫秒数
- 后缀：4字符随机字符串（小写+数字）
- 示例：`1748438204041_a7k9`

| 函数 | 用途 | 返回值 |
|------|------|--------|
| `generate_message_id()` | 生成唯一消息ID | `str` |

## 使用模式

### 文件处理流水线
```python
from langcrew.utils.file_detect import is_binary_file, get_file_type_hint

def process_file(file_path):
    with open(file_path, 'rb') as f:
        data = f.read()
    
    if is_binary_file(data):
        return f"二进制文件：{get_file_type_hint(data)}"
    else:
        # 作为文本处理
        text_content = data.decode('utf-8')
        return f"文本文件：{len(text_content)}字符"
```

### Token管理
```python
from langcrew.utils.token_counter import TokenCounter, TOKEN_LIMIT

def manage_context(messages, model_name="gpt-4"):
    counter = TokenCounter(model_name)
    token_count, _ = counter.count_messages(messages)
    
    if token_count > TOKEN_LIMIT:
        # 截断消息以适应限制
        return messages[-10:]  # 保留最后10条消息
    
    return messages
```

### 多语言支持
```python
from langcrew.utils.language import detect_language

def get_response_template(user_input):
    lang = detect_language(user_input)
    
    if lang == "zh":
        return "我理解了您的问题："
    else:
        return "I understand your question:"
```

## 何时使用工具库

- **文件处理应用程序**需要智能文件类型检测
- **Token感知应用程序**需要LLM使用的精确token计数
- **多语言应用程序**需要简单的语言检测
- **基于消息的系统**需要唯一ID生成
- **代理开发**需要常见实用工具函数

## 下一步

- **[工具库快速开始](/zh/guides/utils/getting-started)** - 5分钟快速开始
- **[实用示例](/zh/guides/utils/examples)** - 真实世界使用示例
- **[高级配置](/zh/guides/utils/configuration)** - 高级实用工具配置