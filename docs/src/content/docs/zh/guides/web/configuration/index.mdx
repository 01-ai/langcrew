---
title: Web服务配置
description: Web服务的完整配置指南
---

Web服务的全面配置指南，满足您的需求。

## 基础配置

### 简单HTTP服务器

用于基本API端点：

```python
from langcrew.web import create_server

# 基本服务器配置
server = create_server(
    host="0.0.0.0",
    port=8000,
    cors_origins=["http://localhost:3000"],
    debug=False
)
```

### LangGraph服务器

用于高级工作流集成：

```python
from langcrew.web import create_langgraph_server

# LangGraph服务器配置
server = create_langgraph_server(
    crew=crew,
    host="0.0.0.0",
    port=8000,
    enable_streaming=True,
    tool_display=True,
    cors_origins=["*"]
)
```

## 高级配置

### 自定义设置的AdapterServer

用于完全控制服务器行为：

```python
from langcrew.web import AdapterServer, LangGraphAdapter

# 创建自定义适配器
adapter = LangGraphAdapter(
    crew=crew,
    enable_streaming=True,
    stream_tool_calls=True,
    tool_display=True,
    max_concurrent_requests=10,
    request_timeout=300
)

# 创建自定义设置的服务器
server = AdapterServer(
    adapter=adapter,
    host="0.0.0.0",
    port=8000,
    cors_origins=["https://yourdomain.com"],
    cors_allow_credentials=True,
    cors_allow_methods=["GET", "POST", "PUT", "DELETE"],
    cors_allow_headers=["*"],
    debug=False,
    access_log=True
)
```

### 生产配置

用于生产部署：

```python
from langcrew.web import AdapterServer
import logging

# 配置日志
logging.basicConfig(level=logging.INFO)

# 生产服务器
server = AdapterServer(
    adapter=adapter,
    host="0.0.0.0",
    port=8000,
    cors_origins=[
        "https://app.yourdomain.com",
        "https://admin.yourdomain.com"
    ],
    cors_allow_credentials=True,
    debug=False,
    access_log=True,
    workers=4,  # 多个工作进程以提高可扩展性
    ssl_keyfile="/path/to/key.pem",
    ssl_certfile="/path/to/cert.pem"
)
```

## 配置模式

### 模式 1：开发服务器

用于带热重载的本地开发：

```python
dev_server = create_server(
    agents=[agent],
    host="127.0.0.1",
    port=8000,
    cors_origins=["http://localhost:3000", "http://localhost:3001"],
    debug=True,
    reload=True,
    access_log=True
)
```

### 模式 2：纯API服务器

用于无头API服务：

```python
api_server = AdapterServer(
    adapter=adapter,
    host="0.0.0.0",
    port=8080,
    cors_origins=["*"],
    debug=False,
    docs_url="/api/docs",  # Swagger UI
    redoc_url="/api/redoc"  # ReDoc
)
```

### 模式 3：流式优先服务器

用于实时应用：

```python
streaming_adapter = LangGraphAdapter(
    crew=crew,
    enable_streaming=True,
    stream_tool_calls=True,
    stream_intermediate_steps=True,
    buffer_size=1024,
    flush_interval=0.1
)

streaming_server = AdapterServer(
    adapter=streaming_adapter,
    host="0.0.0.0",
    port=8000,
    websocket_ping_interval=30,
    websocket_ping_timeout=10
)
```

## 服务器配置选项

### 基本服务器选项

| 参数 | 类型 | 描述 | 默认值 |
|------|------|------|--------|
| `host` | str | 服务器主机地址 | "127.0.0.1" |
| `port` | int | 服务器端口号 | 8000 |
| `debug` | bool | 启用调试模式 | False |
| `reload` | bool | 更改时自动重载 | False |
| `access_log` | bool | 启用访问日志 | True |
| `workers` | int | 工作进程数量 | 1 |

### CORS 配置

| 参数 | 类型 | 描述 | 默认值 |
|------|------|------|--------|
| `cors_origins` | List[str] | 允许的源 | [] |
| `cors_allow_credentials` | bool | 允许凭据 | False |
| `cors_allow_methods` | List[str] | 允许的HTTP方法 | ["GET", "POST"] |
| `cors_allow_headers` | List[str] | 允许的头部 | [] |

### SSL 配置

| 参数 | 类型 | 描述 | 默认值 |
|------|------|------|--------|
| `ssl_keyfile` | str \| None | SSL私钥文件 | None |
| `ssl_certfile` | str \| None | SSL证书文件 | None |
| `ssl_ca_certs` | str \| None | SSL CA证书 | None |

## 适配器配置

### LangGraphAdapter 选项

| 参数 | 类型 | 描述 | 默认值 |
|------|------|------|--------|
| `enable_streaming` | bool | 启用响应流式传输 | False |
| `stream_tool_calls` | bool | 流式传输工具调用执行 | False |
| `stream_intermediate_steps` | bool | 流式传输工作流步骤 | False |
| `tool_display` | bool | 启用工具可视化 | False |
| `max_concurrent_requests` | int | 最大并发请求数 | 100 |
| `request_timeout` | int | 请求超时（秒） | 300 |

### 工具显示配置

```python
from langcrew.web import ToolDisplayManager

# 配置工具显示
display_manager = ToolDisplayManager(
    show_parameters=True,
    show_results=True,
    show_timing=True,
    format_json=True,
    max_result_length=1000
)

adapter = LangGraphAdapter(
    crew=crew,
    tool_display_manager=display_manager
)
```

## 安全配置

### 认证中间件

```python
from fastapi import HTTPException, Depends
from fastapi.security import HTTPBearer

security = HTTPBearer()

def verify_token(token: str = Depends(security)):
    if token.credentials != "your-secret-token":
        raise HTTPException(status_code=401, detail="无效令牌")
    return token

# 添加到服务器
server.add_middleware(verify_token)
```

### 限流

```python
from slowapi import Limiter, _rate_limit_exceeded_handler
from slowapi.util import get_remote_address

limiter = Limiter(key_func=get_remote_address)

# 应用限流
@limiter.limit("10/minute")
async def chat_endpoint():
    # 您的端点逻辑
    pass
```

## 监控和日志

### 结构化日志

```python
import logging
import json

class StructuredLogger:
    def __init__(self):
        self.logger = logging.getLogger("langcrew.web")
        
    def log_request(self, request_id, method, path, status):
        self.logger.info(json.dumps({
            "request_id": request_id,
            "method": method,
            "path": path,
            "status": status,
            "timestamp": time.time()
        }))

# 添加到服务器
server.add_logging(StructuredLogger())
```

### 健康检查端点

```python
@server.get("/health")
async def health_check():
    return {
        "status": "healthy",
        "timestamp": time.time(),
        "version": "1.0.0"
    }
```

## 性能调优

### 优化吞吐量

```python
# 高吞吐量配置
server = AdapterServer(
    adapter=adapter,
    workers=8,  # 多个工作进程
    max_concurrent_requests=200,
    request_timeout=60,  # 更短的超时
    keep_alive_timeout=5
)
```

### 优化延迟

```python
# 低延迟配置
adapter = LangGraphAdapter(
    crew=crew,
    enable_streaming=True,
    buffer_size=512,  # 更小的缓冲区
    flush_interval=0.05,  # 更快的刷新
    max_concurrent_requests=50
)
```

## 最佳实践

- **生产环境使用HTTPS**：始终配置SSL证书
- **正确配置CORS**：将源限制为可信域
- **启用限流**：防止滥用
- **监控性能**：跟踪响应时间和错误率
- **使用结构化日志**：实现更好的调试和监控
- **配置超时**：防止请求挂起
- **水平扩展**：高负载时使用多个工作进程

## 下一步

- **[Web服务概念](/zh/concepts/web)** - 理解架构
- **[快速开始](/zh/guides/web/getting-started)** - 快速开始指南
- **示例** - 查看 `examples/components/web/` 了解实现案例
- **[社区论坛](https://github.com/01-ai/langcrew/discussions)** - 获得帮助
