---
title: 工具库 - 快速开始
description: 5分钟快速上手工具库
---

快速指南，让工具库在您的langcrew应用中工作。

## 安装

工具库包含在langcrew中 - 无需额外安装：

```bash
uv add langcrew --prerelease=allow --index https://nexus.lingyiwanwu.net/repository/pypi-hosted/simple
```

## 基础示例

### 文件检测

自动检测文件类型并提取元数据：

```python
from langcrew.utils.file_detect import detect_file_type

# 检测各种文件类型
pdf_info = detect_file_type("document.pdf")
print(f"类型: {pdf_info.file_type}")
print(f"MIME: {pdf_info.mime_type}")
print(f"大小: {pdf_info.size} 字节")

# 检测带内容的文本文件
text_info = detect_file_type("README.md", read_content=True)
print(f"内容预览: {text_info.content[:100]}...")
print(f"是文本文件: {text_info.is_text}")
```

### 令牌计数

为不同模型准确计算令牌：

```python
from langcrew.utils.token_counter import TokenCounter

# 为特定模型创建令牌计数器
counter = TokenCounter(model_name="gpt-4")

# 计算文本中的令牌
tokens = counter.count_text("你好，今天怎么样？")
print(f"GPT-4 令牌: {tokens}")

# 基于消息的令牌计数（带精确/近似指示器）
messages = [
    {"role": "system", "content": "您是一个有用的助手。"},
    {"role": "user", "content": "法国的首都是什么？"},
    {"role": "assistant", "content": "法国的首都是巴黎。"}
]

token_count, is_exact = counter.count_messages(messages)
print(f"总对话令牌: {token_count} ({'精确' if is_exact else '近似'})")
```

### 语言检测

检测语言并处理文本：

```python
from langcrew.utils.language import detect_language, detect_chinese

# 检测语言
english_text = "Hello, how are you doing today?"
chinese_text = "你好，今天怎么样？"
mixed_text = "Hello, 世界！"

print(f"英文: {detect_language(english_text)}")  # "en"
print(f"中文: {detect_language(chinese_text)}")    # "zh"

# 中文检测
is_chinese = detect_chinese(mixed_text)
print(f"包含中文: {is_chinese}")  # True（如果>30%中文字符）
```

### 消息工具

生成ID和格式化消息：

```python
from langcrew.utils.message_utils import generate_message_id

# 生成唯一消息ID
msg_id = generate_message_id()
print(f"消息ID: {msg_id}")

# 在Web应用中使用消息跟踪
def create_message(content: str, role: str):
    return {
        "id": generate_message_id(),
        "content": content,
        "role": role,
        "timestamp": time.time()
    }

message = create_message("你好，世界！", "user")
print(message)
```

## 集成示例

在智能体工作流中使用工具：

```python
from langcrew import Agent, Task
from langcrew.utils.file_detect import detect_file_type
from langcrew.utils.token_counter import TokenCounter
from langcrew.utils.language import detect_language

# 创建文档分析智能体
analyzer = Agent(
    role="文档分析师",
    goal="分析文档并提供见解",
    backstory="处理各种文档类型的专家"
)

def analyze_document(file_path: str):
    """全面的文档分析"""
    
    # 步骤1：检测文件类型
    file_info = detect_file_type(file_path, read_content=True)
    print(f"文件类型: {file_info.file_type}")
    
    # 步骤2：如果是文本则计算令牌
    if file_info.is_text and file_info.content:
        counter = TokenCounter(model_name="gpt-4")
        tokens = counter.count_text(file_info.content)
        print(f"令牌数量: {tokens}")
        
        # 步骤3：检测语言
        language = detect_language(file_info.content)
        print(f"语言: {language}")
        
        # 步骤4：创建分析任务
        task = Task(
            agent=analyzer,
            description=f"分析这个{language}文档，包含{tokens}个令牌",
            expected_output="文档摘要和关键见解"
        )
        
        return task.execute()
    
    return f"无法分析{file_info.file_type}文件"

# 测试函数
result = analyze_document("sample.txt")
print(result)
```

## 测试您的设置

### 运行完整示例

```bash
# 设置您的 OpenAI API 密钥
export OPENAI_API_KEY=your_api_key_here

# 从工具库示例目录运行
cd examples/components/utils
uv run utils_example.py
```

这个示例演示了：
- 各种格式的文件类型检测
- 不同模型的令牌计数
- 多语言内容的语言检测
- 消息格式化和ID生成

## 更多示例

要了解更多示例，请查看：

- **📁 `examples/components/utils/`** - 完整的工具实现
- **📄 `examples/components/utils/README.md`** - 设置说明
- **🐍 `examples/components/utils/utils_example.py`** - 可运行代码
- **📊 `examples/components/utils/token_analysis.py`** - 令牌计数示例

## 故障排除

### 文件检测问题

确保文件存在且可读：
```python
import os

# ❌ 错误 - 文件不存在
file_info = detect_file_type("nonexistent.txt")

# ✅ 正确 - 检查文件是否存在
if os.path.exists("document.pdf"):
    file_info = detect_file_type("document.pdf")
else:
    print("文件未找到")
```

### 令牌计数错误

使用支持的模型名称：
```python
# ❌ 错误 - 不支持的模型
counter = TokenCounter(model_name="unsupported-model")

# ✅ 正确 - 支持的模型
counter = TokenCounter(model_name="gpt-4")
counter = TokenCounter(model_name="claude-3")
```

### 语言检测问题

为准确检测提供足够的文本：
```python
# ❌ 错误 - 太短
lang = detect_language("你好")  # 可能不准确

# ✅ 正确 - 足够的文本
lang = detect_language("你好，今天过得怎么样？")
```

### 导入错误

确保您从正确的模块导入：
```python
# 核心工具
from langcrew.utils.file_detect import detect_file_type
from langcrew.utils.token_counter import TokenCounter

# 语言工具
from langcrew.utils.language import detect_language, detect_chinese

# 消息工具
from langcrew.utils.message_utils import generate_message_id
```

## 下一步

- **[配置指南](/zh/guides/utils/configuration)** - 学习所有选项
- **[工具库概念](/zh/concepts/utils)** - 理解架构
- **示例** - 查看 `examples/components/utils/` 了解实现案例