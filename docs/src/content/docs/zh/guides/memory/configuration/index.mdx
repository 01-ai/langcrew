---
title: 内存管理配置
description: 内存管理的完整配置指南
---

内存管理的全面配置指南，满足您的需求。

## 基础配置

### 内存存储（开发环境）

用于开发和测试：

```python
from langcrew.memory import MemoryConfig

# 简单的内存配置
memory_config = MemoryConfig(
    provider="memory",
    short_term={"max_history": 20},
    long_term={"enabled": True},
    entity={"enabled": True}
)
```

### SQLite 存储（单节点）

用于单节点生产部署：

```python
memory_config = MemoryConfig(
    provider="sqlite",
    connection_string="sqlite:///langcrew_memory.db",
    short_term={
        "max_history": 100,
        "auto_inject": True,
        "relevance_threshold": 0.8
    },
    long_term={
        "enabled": True,
        "chunk_size": 1000,
        "search_k": 10,
        "min_quality": 0.7
    }
)
```

## 高级配置

### PostgreSQL（分布式生产）

用于可扩展的生产部署：

```python
memory_config = MemoryConfig(
    provider="postgres",
    connection_string="postgresql://user:password@host:port/database",
    short_term={
        "enabled": True,
        "max_history": 200,
        "auto_inject": True
    },
    long_term={
        "enabled": True,
        "embedding_model": "text-embedding-ada-002",
        "chunk_size": 1500,
        "search_k": 15
    },
    entity={
        "enabled": True,
        "extract_entities": True,
        "entity_types": ["person", "organization", "location", "product"]
    }
)
```

### Redis（高性能）

用于高性能缓存：

```python
memory_config = MemoryConfig(
    provider="redis",
    connection_string="redis://localhost:6379/0",
    short_term={
        "max_history": 50,
        "relevance_threshold": 0.9
    }
)
```

## 配置模式

### 模式 1：客户服务智能体

用于具有对话历史的客户服务：

```python
customer_service_memory = MemoryConfig(
    provider="postgres",
    connection_string="postgresql://user:pass@db/customer_service",
    short_term={
        "enabled": True,
        "max_history": 100,
        "auto_inject": True
    },
    entity={
        "enabled": True,
        "entity_types": ["person", "product", "issue", "date"]
    },
    shared_namespaces=["customer_profiles", "product_catalog"]
)
```

### 模式 2：研究助手

用于具有长期知识存储的研究：

```python
research_memory = MemoryConfig(
    provider="sqlite",
    connection_string="sqlite:///research_knowledge.db",
    long_term={
        "enabled": True,
        "chunk_size": 2000,
        "search_k": 20,
        "min_quality": 0.6
    },
    entity={
        "enabled": True,
        "entity_types": ["person", "organization", "concept", "publication"]
    }
)
```

### 模式 3：团队协作

用于共享知识的团队：

```python
team_memory = MemoryConfig(
    provider="postgres",
    connection_string="postgresql://user:pass@db/team_memory",
    shared_namespaces=["team_knowledge", "project_context"],
    short_term={"max_history": 30},
    long_term={
        "enabled": True,
        "search_k": 10
    },
    entity={
        "enabled": True,
        "entity_types": ["person", "project", "task", "deadline"]
    }
)
```

## 内存类型配置

### 短期记忆选项

| 参数 | 类型 | 描述 | 默认值 |
|------|------|------|--------|
| `enabled` | bool | 启用短期记忆 | True |
| `auto_inject` | bool | 自动注入上下文到提示 | True |
| `max_history` | int | 最大对话历史 | 20 |
| `relevance_threshold` | float | 最小相关性分数 | 0.7 |

### 长期记忆选项

| 参数 | 类型 | 描述 | 默认值 |
|------|------|------|--------|
| `enabled` | bool | 启用长期记忆 | True |
| `embedding_model` | str \| None | 嵌入模型名称 | None |
| `chunk_size` | int | 存储的文本块大小 | 500 |
| `search_k` | int | 检索的结果数量 | 5 |
| `min_quality` | float | 最小质量阈值 | 0.7 |

### 实体记忆选项

| 参数 | 类型 | 描述 | 默认值 |
|------|------|------|--------|
| `enabled` | bool | 启用实体记忆 | True |
| `extract_entities` | bool | 自动提取实体 | True |
| `entity_types` | List[str] | 要跟踪的实体类型 | ["person", "organization", "location", "concept"] |

## 最佳实践

- **选择合适的提供商**：单节点使用 SQLite，生产环境使用 PostgreSQL
- **配置适当的限制**：设置合理的 `max_history` 和 `search_k` 值
- **使用共享命名空间**：在相关智能体间启用知识共享
- **监控内存使用**：定期清理旧的或无关的记忆
- **安全连接**：生产数据库连接使用 SSL/TLS
- **定期备份**：为持久内存实施备份策略

## 性能调优

### 优化搜索性能

```python
# 针对性能调优
memory_config = MemoryConfig(
    provider="postgres",
    long_term={
        "chunk_size": 1000,  # 更大的块以获得更好的上下文
        "search_k": 5,       # 更少的结果以提高速度
        "min_quality": 0.8   # 更高的相关性阈值
    }
)
```

### 优化存储大小

```python
# 针对存储效率调优
memory_config = MemoryConfig(
    short_term={
        "max_history": 50,   # 限制历史大小
        "relevance_threshold": 0.9  # 只保留高度相关的
    }
)
```

## 下一步

- **[内存管理概念](/zh/concepts/memory)** - 理解架构
- **[快速开始](/zh/guides/memory/getting-started)** - 快速开始指南
- **示例** - 查看 `examples/components/memory/` 了解实现案例
- **[社区论坛](https://github.com/01-ai/langcrew/discussions)** - 获得帮助